<!DOCTYPE html>
<html>
    <head>
        <title>Row Cloning</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

        <script>

        var formInput = {
            "parent_nameFirst": ["Chris", "Ruthie"],
            "parent_nameLast": ["Schmitz", "Whittam"],
            "phone": ["314.650.8682", "314.123.4567"],
            "email": ["schmitz.chris@gmail.com", "ruthie@chrisandruthie.com"],
            "student_nameFirst": ["Petey", "Zoe", "Madori"],
            "student_nameLast": ["Puppy", "Doggie", "Kitty"],
            "age": ["4", "1", "8"],
            "grade": ["1", "4", "12"],
            "zip": ["63139", "12345", "54321"],
            "program_interests": ["bikeworks", "bikeworks, bookworks", "bikeworks, bookworks, byteworks"]
        }


        $(document).ready(function (){

            function formBuilder(formInput){
                this.formInput = formInput;
                this.totalRows = {
                    'parent': this.formInput.parent_nameFirst.length, 
                    'students': this.formInput.student_nameFirst.length
                };
                this.cloneFormRow = function (type){
                    var tableId = "#" + type + "Table";
                    var tableBody = $(tableId).find("tbody");
                    var newRow = tableBody.find(".inputRow").first().clone().find("input").val('').end();
                    newRow.appendTo(tableBody);

                };
                this.populateRowInputs = function (){
                    $.each(this.formInput,function (key, value){
                        var inputsName = "input[name=" + key + "]";
                        var input = $(inputsName);
                        var myvals = this;
                        $.each(input,function (index){
                            $(this).val(myvals[index]);
                        });
                    });
                };
                this.buildForm = function(){
                debugger;
                    var parentRowCount = formInput.parent_nameFirst.length ;
                    var studentRowCount = formInput.student_nameFirst.length ;
                    for(i=1 ; i < parentRowCount  ; i++){
                        this.cloneFormRow('parent');
                    }
                    for(i=1 ; i < studentRowCount  ; i++){
                        this.cloneFormRow('student');
                    }
                    this.populateRowInputs();
                }

            }

            // Actual form manipulation
            // the rest of the logic should be abstracted to a separate file 
            // and the following commands are what should be run on the page.
            builder = new formBuilder(formInput);
            builder.buildForm();


            $("#parentButton").on("click", function (){
                builder.cloneFormRow('parent');
            });
            
            $("#studentButton").on("click", function (){
                builder.cloneFormRow('student');
            });

        });

        </script>

    </head>
    <body>
       <table id="parentTable">
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Phone</th>
                <th>Email</th>
            </tr>
            <tr class="inputRow">
                <td><input name="parent_nameFirst"></td>
                <td><input name="parent_nameLast"></td>
                <td><input name="phone"></td>
                <td><input name="email"></td>
            </tr>
       </table>
       <table id="studentTable">
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Age</th>
                <th>Grade</th>
                <th>Zip</th>
                <th>Program Interests</th>
            </tr>
            <tr class="inputRow">
                <td><input name="student_nameFirst"></td>
                <td><input name="student_nameLast"></td>
                <td><input name="age"></td>
                <td><input name="grade"></td>
                <td><input name="zip"></td>
                <td><input name="program_interests"></td>
            </tr>
       </table>

       <div>
            <button id="parentButton" type="button">Duplicate Parent Row</button>
            <button id="studentButton" type="button">Duplicate Student Row</button>
       </div>
    </body>
</html>
